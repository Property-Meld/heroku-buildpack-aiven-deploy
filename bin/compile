#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

# fail fast
set -ueo pipefail

build_dir=$1
env_dir=$3
echo $0
BIN_DIR=$(cd $(dirname $0); pwd) # absolute path

# install heroku cli, stdlib, export keys
source "$BIN_DIR/steps/heroku"

source "$BIN_DIR/steps/displayinfo"


puts_step "try avn client"
avn --auth-token $AIVEN_AUTH_TOKEN project list

puts_step "deploy aiven instance"

puts_step "$(invoke -r $BIN_DIR --list)"


for TASK in service-create-aiven-db create-db-task create-pool-uri-and-set-env setup-review-app-database;do
    echo running invoke -r $BIN_DIR $TASK
    invoke -r $BIN_DIR $TASK
done