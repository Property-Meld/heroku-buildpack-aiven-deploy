#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

# fail fast
set -ueo pipefail

build_dir=$1
env_dir=$3
BIN_DIR=$(cd $(dirname $0); pwd) # absolute path

source /dev/stdin <<< "$(curl -s --retry 3 https://lang-common.s3.amazonaws.com/buildpack-stdlib/v4/stdlib.sh)"

# install python
# source $BIN_DIR/steps/python

puts_step "install aiven-client"
python -m pip install git+https://github.com/aiven/aiven-client.git
puts_step "deploy aiven instance"
echo "build_dir: $build_dir"
echo "BIN_DIR: $BIN_DIR"
echo "pwd: $(pwd)"
for X in ls $(pwd);do
    echo $X
done
for X in ls $build_dir;do
    echo $X
done
for X in ls $BIN_DIR;do
    echo $X
done
puts_step "$(invoke -r $(pwd) --list)"
invoke -r $(pwd) setup-review-app-database